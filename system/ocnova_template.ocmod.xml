<?xml version="1.0" encoding="utf-8"?>
<modification>
	<name>Template core features</name>
	<code>templatecore</code>
	<version>1.0</version>
	<author>pasha.strus@gmail.com</author>
	<link>http://ocnova.pro</link>

    <file path="admin/controller/catalog/product.php">
        <operation>
            <search ><![CDATA[if (isset($this->request->post['status'])) {]]></search>
            <add position="before"><![CDATA[
            //added template
            $data['promo_labels'] = array(
                array('promo_label_id' => 1, 'name' => 'Акция'),
                array('promo_label_id' => 2, 'name' => 'Хит продаж'),
                array('promo_label_id' => 3, 'name' => 'Новинка'),
                array('promo_label_id' => 4, 'name' => 'Суперцена'),
                array('promo_label_id' => 5, 'name' => 'Уценка')
            );

            if (isset($this->request->post['promo_label_id'])) {
                $data['promo_label_id'] = $this->request->post['promo_label_id'];
            } elseif (!empty($product_info)) {
                $data['promo_label_id'] = $product_info['promo_label_id'];
            } else {
                $data['promo_label_id'] = 0;
            }
            //added template
			]]></add>
        </operation>
    </file>

    <file path="admin/controller/setting/setting.php">
        <operation>
            <search ><![CDATA[if (isset($this->error['image_location'])) {]]></search>
            <add position="before"><![CDATA[
            //added template
            if (isset($this->error['image_cart_popup'])) {
                $data['error_image_cart_popup'] = $this->error['image_cart_popup'];
            } else {
                $data['error_image_cart_popup'] = '';
            }
            if (isset($this->error['image_subcat'])) {
                $data['error_image_subcat'] = $this->error['image_subcat'];
            } else {
                $data['error_image_subcat'] = '';
            }
            //added template
			]]></add>
        </operation>
        <operation>
            <search ><![CDATA[$data['header'] = $this->load->controller('common/header');]]></search>
            <add position="before"><![CDATA[
                //added template
                //lang todo
                $data['entry_telephone_add'] = $this->language->get('entry_telephone_add');

                //extension
                $this->load->model('extension/module');
                $data['extensions'] = array();
                $extensions = $this->model_extension_extension->getInstalled('module');

                foreach ($extensions as $code) {
                    $this->load->language('module/' . $code);

                    $module_data = array();

                    $modules = $this->model_extension_module->getModulesByCode($code);

                    foreach ($modules as $module) {
                        $module_data[] = array(
                            'name' => strip_tags($this->language->get('heading_title') . ' &gt; ' . $module['name']),
                            'code' => $code . '.' .  $module['module_id']
                        );
                    }

                    if ($code == 'html') {
                        if ($this->config->has($code . '_status') || $module_data) {
                            $data['extensions'][] = array(
                                'name'   => strip_tags($this->language->get('heading_title')),
                                'code'   => $code,
                                'module' => $module_data
                            );
                        }
                    }
                }

                //banner
                $this->load->model('design/banner');
                $data['banners'] = $this->model_design_banner->getBanners();

                //hardcoded todo
                $data['colors'] = array(
                    array('color_id' => 1, 'name' => 'red'),
                    array('color_id' => 2, 'name' => 'blue'),
                    array('color_id' => 3, 'name' => 'green')
                );

                $configs_template = array(
                    'config_top_info',
                    'config_topleft_html_module',
                    'config_top_html_module',
                    'config_header_phone',
                    'config_header_phone',
                    'config_header_phone_add',
                    'config_header_widget',
                    'config_widget_code',
                    'config_telephone_add',
                    'config_header_html_module',
                    'config_image_cart_popup_width',
                    'config_image_cart_popup_height',
                    'config_image_subcat_width',
                    'config_image_subcat_height',
                    'config_premenu_html_module',
                    'config_aftermenu_html_module',
                    'config_footerone_html_module',
                    'config_footertwo_html_module',
                    'config_footerthree_html_module',
                    'config_footerfour_html_module',
                    'config_povered_html_module',
                    'config_footer_banner_id',
                    'config_show_scrollup',
                    'config_color_theme_id',
                    'config_maincolor',
                    'config_mainhovercolor',
                    'config_custom_css',
                    'config_not_instock_toend',
                    'config_show_text_refine',
                    'config_subcat_text_view',
                    'config_products_label_stock',
                    'config_products_label_special',
                    'config_modules_label_stock',
                    'config_modules_label_special',
                    'config_category_description_top',
                    'config_category_show_image',
                    'config_disable_timepicker',
                    'config_disable_fastorder'
                );

                foreach ($configs_template as $item) {
                    if (isset($this->request->post[$item])) {
                        $data[$item] = $this->request->post[$item];
                    } else {
                        $data[$item] = $this->config->get($item);
                    }
                }
                //added template
			]]></add>
        </operation>
        <operation>
            <search ><![CDATA[if (!$this->request->post['config_image_location_width'] || !$this->request->post['config_image_location_height']) {]]></search>
            <add position="before"><![CDATA[
            //added template
            if (!$this->request->post['config_image_cart_popup_width'] || !$this->request->post['config_image_cart_popup_height']) {
                $this->error['image_cart_popup'] = $this->language->get('error_image_cart_popup');
            }
            if (!$this->request->post['config_image_subcat_width'] || !$this->request->post['config_image_subcat_height']) {
                $this->error['image_subcat'] = $this->language->get('error_image_subcat');
            }
            //added template
			]]></add>
        </operation>
    </file>

    <file path="admin/controller/module/html.php">
        <operation>
            <search ><![CDATA[$data['header'] = $this->load->controller('common/header');]]></search>
            <add position="before"><![CDATA[
            //added template
            if (isset($this->request->post['editor'])) {
                $data['editor'] = $this->request->post['editor'];
            } elseif ((!empty($module_info))&&(isset($module_info['editor']))) {
                $data['editor'] = $module_info['editor'];
            } else {
                $data['editor'] = '';
            }
            //added template
			]]></add>
        </operation>
    </file>

    <file path="admin/model/catalog/product.php">
        <operation>
            <search ><![CDATA[if (isset($data['image'])) {]]></search>
            <add position="before"><![CDATA[
                //added template
                if (isset($data['promo_label_id'])) {
                    $this->db->query("UPDATE " . DB_PREFIX . "product SET promo_label_id = '" . (int)$data['promo_label_id'] . "' WHERE product_id = '" . (int)$product_id . "'");
                }
                //added template
			]]></add>
        </operation>
        <operation>
            <search><![CDATA[if (isset($data['product_store'])) {]]></search>
            <add position="before"><![CDATA[
                //added template
                foreach ($data['product_description'] as $language_id => $value) {
                    $this->db->query("UPDATE " . DB_PREFIX . "product_description
                    SET short_description = '" . $this->db->escape($value['short_description']) . "'
                    WHERE product_id = '" . (int)$product_id . "'
                    AND language_id = '" . (int)$language_id . "'");
                }
                //added template
			]]></add>
        </operation>
        <operation>
            <search><![CDATA['meta_keyword'     => $result['meta_keyword'],]]></search>
            <add position="after"><![CDATA[
                'short_description'     => $result['short_description'], //added template
			]]></add>
        </operation>
    </file>

	<file path="admin/view/template/common/header.tpl">
		<operation>
			<search ><![CDATA[
				<link href="view/javascript/summernote/summernote.css" rel="stylesheet" />
			]]></search>
			<add position="after"><![CDATA[
                <!--//added template-->
                <link href="view/javascript/colorpicker/css/bootstrap-colorpicker.min.css" rel="stylesheet" />
                <script type="text/javascript" src="view/javascript/colorpicker/js/bootstrap-colorpicker.min.js"></script>
                <!--//added template-->
			]]></add>
		</operation>
	</file>

	<file path="admin/view/template/catalog/product_form.tpl">
		<operation>
			<search ><![CDATA[<label class="col-sm-2 control-label" for="input-tag<?php echo $language['language_id']; ?>"><span data-toggle="tooltip" title="<?php echo $help_tag; ?>"><?php echo $entry_tag; ?></span></label>]]></search>
			<add position="before" offset="1"><![CDATA[
                    <!--//added template-->
                  <div class="form-group">
                    <label class="col-sm-2 control-label" for="input-short-description<?php echo $language['language_id']; ?>">Краткое описание:</label>
                    <div class="col-sm-10">
                      <textarea name="product_description[<?php echo $language['language_id']; ?>][short_description]" rows="5" placeholder="Краткое описание" id="input-short-description<?php echo $language['language_id']; ?>" class="form-control"><?php echo isset($product_description[$language['language_id']]) ? $product_description[$language['language_id']]['short_description'] : ''; ?></textarea>
                    </div>
                  </div>
                    <!--//added template-->
			]]></add>
		</operation>
        <operation>
			<search ><![CDATA[<label class="col-sm-2 control-label"><?php echo $entry_shipping; ?></label>]]></search>
			<add position="before" offset="1"><![CDATA[
                <!--//added template-->
                <div class="form-group">
                    <label class="col-sm-2 control-label" for="input-promo-label">Стикер товара</label>
                    <div class="col-sm-10">
                        <select name="promo_label_id" id="input-promo-label" class="form-control">
                            <option value="0"><?php echo $text_no; ?></option>
                            <?php foreach ($promo_labels as $promo_label) { ?>
                                <?php if ($promo_label['promo_label_id'] == $promo_label_id) { ?>
                                    <option value="<?php echo $promo_label['promo_label_id']; ?>" selected="selected"><?php echo $promo_label['name']; ?></option>
                                <?php } else { ?>
                                    <option value="<?php echo $promo_label['promo_label_id']; ?>"><?php echo $promo_label['name']; ?></option>
                                <?php } ?>
                            <?php } ?>
                        </select>
                    </div>
                </div>
                <!--//added template-->
			]]></add>
		</operation>
	</file>

	<file path="admin/view/template/setting/setting.tpl">
		<operation>
			<search ><![CDATA[
				<li><a href="#tab-image" data-toggle="tab"><?php echo $tab_image; ?></a></li>
			]]></search>
			<add position="after"><![CDATA[
              <!--//added template-->
            <li><a href="#tab-template" data-toggle="tab">Шаблон</a></li>
			]]></add>
		</operation>
        <operation>
			<search ><![CDATA[
				<label class="col-sm-2 control-label" for="input-fax"><?php echo $entry_fax; ?></label>
			]]></search>
			<add position="before" offset="1"><![CDATA[
                <!--//added template-->
                <div class="form-group required">
                    <label class="col-sm-2 control-label" for="input-telephone_add"><?php echo $entry_telephone_add; ?></label>
                    <div class="col-sm-10">
                        <textarea name="config_telephone_add" placeholder="<?php echo $entry_telephone_add; ?>" id="input-telephone_add" class="form-control"><?php echo $config_telephone_add; ?></textarea>
                    </div>
                </div>
                <!--//added template-->
			]]></add>
		</operation>
        <operation>
			<search ><![CDATA[<div class="tab-pane" id="tab-ftp">]]></search>
			<add position="before"><![CDATA[
              <!--//added template-->
              <div class="tab-pane" id="tab-template">
                  <div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">
                      <div class="panel panel-default">
                          <div class="panel-heading" role="tab" id="headingOne">
                              <h4 class="panel-title">
                                  <a role="button" data-toggle="collapse" data-parent="#accordion" href="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                                      Верхнее меню
                                  </a>
                              </h4>
                          </div>
                          <div id="collapseOne" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingOne">
                              <div class="panel-body">
                                  <?php getRadioYN($config_top_info, 'config_top_info', 'Показывать выпадающее меню с категориями статей'); ?>
                                  <?php getHtmlModule($extensions, $config_topleft_html_module, 'config_topleft_html_module', 'HTML слева', 'Выберите один из модулей HTML. Его содержимое будет выведено перед переключателем языка и валюты'); ?>
                                  <?php getHtmlModule($extensions, $config_top_html_module, 'config_top_html_module', 'HTML справа', 'Выберите один из модулей HTML. Его содержимое будет выведено внутри тега ul'); ?>
                              </div>
                          </div>
                      </div>

                      <div class="panel panel-default">
                          <div class="panel-heading" role="tab" id="headingTwo">
                              <h4 class="panel-title">
                                  <a class="collapsed" role="button" data-toggle="collapse" data-parent="#accordion" href="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
                                      Телефоны в шапке
                                  </a>
                              </h4>
                          </div>
                          <div id="collapseTwo" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingTwo">
                              <div class="panel-body">
                                  <?php getRadioYN($config_header_phone, 'config_header_phone', 'Показывать основной телефон'); ?>
                                  <?php getRadioYN($config_header_phone_add, 'config_header_phone_add', 'Показывать дополнительные телефоны'); ?>
                                  <?php getRadioYN($config_header_widget, 'config_header_widget', 'Показывать виджет'); ?>
                                  <div class="form-group">
                                      <label class="col-sm-3 control-label" for="input-widget-code"><span data-toggle="tooltip" title="Код виджета в формате оператор==код==номер. Каждый с новой строки">Код виджета</span></label>
                                      <div class="col-sm-9">
                                          <textarea name="config_widget_code" rows="5" placeholder="Vodafone==099==000 00 00" id="input-widget-code" class="form-control"><?php echo $config_widget_code; ?></textarea>
                                      </div>
                                  </div>
                                  <?php getHtmlModule($extensions, $config_header_html_module, 'config_header_html_module', 'HTML в блоке телефонов', 'Выберите один из модулей HTML'); ?>
                              </div>
                          </div>
                      </div>

                      <div class="panel panel-default">
                          <div class="panel-heading" role="tab" id="headingThree">
                              <h4 class="panel-title">
                                  <a class="collapsed" role="button" data-toggle="collapse" data-parent="#accordion" href="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
                                     Главное меню
                                  </a>
                              </h4>
                          </div>
                          <div id="collapseThree" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingThree">
                              <div class="panel-body">
                                  <?php getHtmlModule($extensions, $config_premenu_html_module, 'config_premenu_html_module', 'HTML перед меню', 'Выберите один из модулей HTML. Его содержимое будет выведено внутри тега ul'); ?>
                                  <?php getHtmlModule($extensions, $config_aftermenu_html_module, 'config_aftermenu_html_module', 'HTML после меню', 'Выберите один из модулей HTML. Его содержимое будет выведено внутри тега ul'); ?>
                              </div>
                          </div>
                      </div>

                      <div class="panel panel-default">
                          <div class="panel-heading" role="tab" id="headingFour">
                              <h4 class="panel-title">
                                  <a class="collapsed" role="button" data-toggle="collapse" data-parent="#accordion" href="#collapseFour" aria-expanded="false" aria-controls="collapseFour">
                                      Футер (низ сайта)
                                  </a>
                              </h4>
                          </div>
                          <div id="collapseFour" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingFour">
                              <div class="panel-body">
                                  <?php getHtmlModule($extensions, $config_footerone_html_module, 'config_footerone_html_module', 'HTML первого блока', 'Выберите один из модулей HTML. Его содержимое будет выведено вместо колонки'); ?>
                                  <?php getHtmlModule($extensions, $config_footertwo_html_module, 'config_footertwo_html_module', 'HTML второго блока', 'Выберите один из модулей HTML. Его содержимое будет выведено вместо колонки'); ?>
                                  <?php getHtmlModule($extensions, $config_footerthree_html_module, 'config_footerthree_html_module', 'HTML третьего блока', 'Выберите один из модулей HTML. Его содержимое будет выведено вместо колонки'); ?>
                                  <?php getHtmlModule($extensions, $config_footerfour_html_module, 'config_footerfour_html_module', 'HTML четвертого блока', 'Выберите один из модулей HTML. Его содержимое будет выведено вместо колонки'); ?>
                                  <?php getHtmlModule($extensions, $config_povered_html_module, 'config_povered_html_module', 'Копирайт', 'Выберите один из модулей HTML'); ?>
                                  <div class="form-group">
                                      <label class="col-sm-3 control-label" for="input-footer-banner">Набор баннеров(картинок)</label>
                                      <div class="col-sm-9">
                                          <select name="config_footer_banner_id" id="input-footer-banner" class="form-control">
                                              <option value="0"><?php echo $text_none; ?></option>
                                              <?php foreach ($banners as $banner) { ?>
                                                  <?php if ($banner['banner_id'] == $config_footer_banner_id) { ?>
                                                      <option value="<?php echo $banner['banner_id']; ?>" selected="selected"><?php echo $banner['name']; ?></option>
                                                  <?php } else { ?>
                                                      <option value="<?php echo $banner['banner_id']; ?>"><?php echo $banner['name']; ?></option>
                                                  <?php } ?>
                                              <?php } ?>
                                          </select>
                                      </div>
                                  </div>
                                  <?php getRadioYN($config_show_scrollup, 'config_show_scrollup', 'Показывать кнопку прокрутки наверх'); ?>
                              </div>
                          </div>
                      </div>

                      <div class="panel panel-default">
                          <div class="panel-heading" role="tab" id="headingFive">
                              <h4 class="panel-title">
                                  <a class="collapsed" role="button" data-toggle="collapse" data-parent="#accordion" href="#collapseFive" aria-expanded="false" aria-controls="collapseFive">
                                      Цвета и стили
                                  </a>
                              </h4>
                          </div>
                          <div id="collapseFive" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingFive">
                              <div class="panel-body">
                                  <div class="form-group">
                                      <label class="col-sm-3 control-label" for="input-footer-color">Выберите цветовую схему</label>
                                      <div class="col-sm-9">
                                          <span onclick="$('#config_maincolor').colorpicker('setValue', '#E65C4D');$('#config_mainhovercolor').colorpicker('setValue', '#B84A3E');" class="btn btn-default" style="background: #E65C4D; color: #fff;">Red</span>
                                          <span onclick="$('#config_maincolor').colorpicker('setValue', '#2DADFF');$('#config_mainhovercolor').colorpicker('setValue', '#126186');" class="btn btn-default" style="background: #2DADFF; color: #fff;">Blue</span>
                                          <span onclick="$('#config_maincolor').colorpicker('setValue', '#826D4D');$('#config_mainhovercolor').colorpicker('setValue', '#A0845C');" class="btn btn-default" style="background: #826D4D; color: #fff;">Green</span>
                                      </div>
                                  </div>

                                  <div class="form-group">
                                      <label class="col-sm-3 control-label">Измннить основной цвет</label>
                                      <div class="col-sm-9">
                                          <div class="input-group color" id="config_maincolor">
                                            <input type="text" name="config_maincolor" value="<?php echo $config_maincolor; ?>" class="form-control">
                                            <span class="input-group-addon"><i></i></span>
                                          </div>
                                      </div>
                                  </div>

                                  <div class="form-group">
                                      <label class="col-sm-3 control-label">Измннить основной:hover цвет</label>
                                      <div class="col-sm-9">
                                          <div class="input-group color" id="config_mainhovercolor">
                                            <input type="text" name="config_mainhovercolor" value="<?php echo $config_mainhovercolor; ?>" class="form-control">
                                            <span class="input-group-addon"><i></i></span>
                                          </div>
                                      </div>
                                  </div>

                                  <div class="form-group">
                                      <label class="col-sm-3 control-label" for="input-custom_css">Свой css</label>
                                      <div class="col-sm-9">
                                          <textarea name="config_custom_css" rows="5" id="input-custom_css" class="form-control"><?php echo $config_custom_css; ?></textarea>
                                      </div>
                                  </div>
                              </div>
                              <script>$('.color').colorpicker();</script>
                          </div>
                      </div>

                      <div class="panel panel-default">
                          <div class="panel-heading" role="tab" id="headingSix">
                              <h4 class="panel-title">
                                  <a class="collapsed" role="button" data-toggle="collapse" data-parent="#accordion" href="#collapseSix" aria-expanded="false" aria-controls="collapseSix">
                                      Отображение товара в модулях (последние, рекомендуем...)
                                  </a>
                              </h4>
                          </div>
                          <div id="collapseSix" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingSix">
                              <div class="panel-body">
                                  <?php getRadioYN($config_modules_label_stock, 'config_modules_label_stock', 'Показывать стикер со статусом на товарах с количеством 0.'); ?>
                                  <?php getRadioYN($config_modules_label_special, 'config_modules_label_special', 'Показывать стикер у товара со скидкой.'); ?>
                              </div>
                          </div>
                      </div>

                      <div class="panel panel-default">
                          <div class="panel-heading" role="tab" id="headingSeven">
                              <h4 class="panel-title">
                                  <a class="collapsed" role="button" data-toggle="collapse" data-parent="#accordion" href="#collapseSeven" aria-expanded="false" aria-controls="collapseSeven">
                                      Отображение товара на страницах товара (категория, поиск...)
                                  </a>
                              </h4>
                          </div>
                          <div id="collapseSeven" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingSeven">
                              <div class="panel-body">
                                  <?php getRadioYN($config_not_instock_toend, 'config_not_instock_toend', 'Поместить товары, у которых количество 0, в конец списка.'); ?>
                                  <?php getRadioYN($config_products_label_stock, 'config_products_label_stock', 'Показывать лейбл со статусом на товарах с количеством 0.'); ?>
                                  <?php getRadioYN($config_products_label_special, 'config_products_label_special', 'Показывать лейбл у товара со скидкой.'); ?>
                              </div>
                          </div>
                      </div>

                      <div class="panel panel-default">
                          <div class="panel-heading" role="tab" id="headingEight">
                              <h4 class="panel-title">
                                  <a class="collapsed" role="button" data-toggle="collapse" data-parent="#accordion" href="#collapseEight" aria-expanded="false" aria-controls="collapseEight">
                                      Страница категории
                                  </a>
                              </h4>
                          </div>
                          <div id="collapseEight" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingEight">
                              <div class="panel-body">
                                  <?php getRadioYN($config_show_text_refine, 'config_show_text_refine', 'Показывать заголовок в выборе подкатегорий'); ?>
                                  <?php getRadioYN($config_subcat_text_view, 'config_subcat_text_view', 'Показывать подкатегории в виде текста'); ?>
                                  <?php getRadioYN($config_category_description_top, 'config_category_description_top', 'Показывать описание вверху', 'Если выбрано НЕТ, то будет показано внизу'); ?>
                                  <?php getRadioYN($config_category_show_image, 'config_category_show_image', 'Показывать изображение в описании категории'); ?>
                              </div>
                          </div>
                      </div>

                      <div class="panel panel-default">
                          <div class="panel-heading" role="tab" id="headingNine">
                              <h4 class="panel-title">
                                  <a class="collapsed" role="button" data-toggle="collapse" data-parent="#accordion" href="#collapseNine" aria-expanded="false" aria-controls="collapseNine">
                                      Страница товара
                                  </a>
                              </h4>
                          </div>
                          <div id="collapseNine" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingNine">
                              <div class="panel-body">
                                  <?php getRadioYN($config_disable_timepicker, 'config_disable_timepicker', 'Отключить скрипты и стили datetimepicker', 'Если не используете опциии типа дата и(или) время, то их можно отключить'); ?>
                                  <?php getRadioYN($config_disable_fastorder, 'config_disable_fastorder', 'Отключить заказ в один клик'); ?>
                              </div>
                          </div>
                      </div>

                  </div>
              </div>
              <!--//added template-->
			]]></add>
		</operation>
        <operation>
			<search ><![CDATA[
				<label class="col-sm-2 control-label" for="input-image-location"><?php echo $entry_image_location; ?></label>
			]]></search>
			<add position="before" index="1"><![CDATA[
                <!--//added template-->
                <div class="form-group required">
                    <label class="col-sm-2 control-label" for="input-image-cart_popup">Во всплывающей корзине</label>
                    <div class="col-sm-10">
                        <div class="row">
                            <div class="col-sm-6">
                                <input type="text" name="config_image_cart_popup_width" value="<?php echo $config_image_cart_popup_width; ?>" placeholder="<?php echo $entry_width; ?>" id="input-image-cart_popup" class="form-control" />
                            </div>
                            <div class="col-sm-6">
                                <input type="text" name="config_image_cart_popup_height" value="<?php echo $config_image_cart_popup_height; ?>" placeholder="<?php echo $entry_height; ?>" class="form-control" />
                            </div>
                        </div>
                        <?php if ($error_image_cart_popup) { ?>
                            <div class="text-danger"><?php echo $error_image_cart_popup; ?></div>
                        <?php } ?>
                    </div>
                </div>
                <div class="form-group required">
                    <label class="col-sm-2 control-label" for="input-image-subcat">Подкатегории на странице категории</label>
                    <div class="col-sm-10">
                        <div class="row">
                            <div class="col-sm-6">
                                <input type="text" name="config_image_subcat_width" value="<?php echo $config_image_subcat_width; ?>" placeholder="<?php echo $entry_width; ?>" id="input-image-subcat" class="form-control" />
                            </div>
                            <div class="col-sm-6">
                                <input type="text" name="config_image_subcat_height" value="<?php echo $config_image_subcat_height; ?>" placeholder="<?php echo $entry_height; ?>" class="form-control" />
                            </div>
                        </div>
                        <?php if ($error_image_subcat) { ?>
                            <div class="text-danger"><?php echo $error_image_subcat; ?></div>
                        <?php } ?>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-2 control-label" for="input-image-cart_popup">Заполнить в соответствии с пропорциями</label>
                    <div class="col-sm-10">
                        <div class="row">
                            <div class="col-sm-offset-6 col-sm-6">
                                <a class="btn btn-primary btn-sm" onclick="calcHeight();">Пересчитать высоту изображений</a>
                            </div>
                        </div>
                    </div>
                </div>
                <script>
                    function calcHeight() {
                        var ow = parseInt($('input[name="config_image_thumb_width"]').val());
                        var oh = parseInt($('input[name="config_image_thumb_height"]').val());
                        var p = oh/ow;

                        if ((ow <= 0) || (oh <= 0)) {
                            alert('Введите размеры большго изображения товара');
                        } else {
                            $('#tab-image .form-group').each(function(){
                                var w = parseInt($(this).find('input[name $= _width]').val());
                                if (w <= 0) {
                                    alert('Неверное значение');
                                }
                                var c = $(this).find('label').attr('for');
                                var h = Math.ceil(w*p);

                                if  (c != 'input-image-location') {
                                    $(this).find('input[name $= _height]').val(h);
                                }
                            })
                        }


                    }
                </script>

                <!--//added template-->
			]]></add>
		</operation>
	</file>

	<file path="admin/view/template/design/layout_form.tpl">
		<operation>
			<search ><![CDATA[
				<?php if ($layout_module['position'] == 'content_top') { ?>
			]]></search>
			<add position="before"><![CDATA[
                <?php if ($layout_module['position'] == 'promo_top') { ?>
                <option value="promo_top" selected="selected">Слайдшоу на всю ширину</option>
                <?php } else { ?>
                <option value="promo_top">Слайдшоу на всю ширину (только главная)</option>
                <?php } ?>
			]]></add>
		</operation>
        <operation>
			<search ><![CDATA[
				html += '    <option value="content_top"><?php echo $text_content_top; ?></option>';
			]]></search>
			<add position="before"><![CDATA[
                html += '    <option value="promo_top">Слайдшоу на всю ширину (только главная)</option>';
			]]></add>
		</operation>
	</file>

    <file path="admin/view/template/module/html.tpl">
        <operation>
            <search ><![CDATA[<div class="tab-pane">]]></search>
            <add position="before"><![CDATA[
            <!--//added template-->
            <div class="form-group">
                <label class="col-sm-2 control-label">Показывать HTML редактор</label>
                <div class="col-sm-10">
                    <label class="radio-inline">
                        <?php if ($editor) { ?>
                            <input type="radio" id="editor_enable" name="editor" value="1" checked="checked" />
                            Да
                        <?php } else { ?>
                            <input type="radio" id="editor_enable" name="editor" value="1" />
                            Да
                        <?php } ?>
                    </label>
                    <label class="radio-inline">
                        <?php if (!$editor) { ?>
                            <input type="radio" id="editor_disable" name="editor" value="0" checked="checked" />
                            Нет
                        <?php } else { ?>
                            <input type="radio" id="editor_disable" name="editor" value="0" />
                            Нет
                        <?php } ?>
                    </label>
                </div>
            </div>
            <!--//added template-->
			]]></add>
        </operation>
        <operation>
            <search ><![CDATA[<?php if ($ckeditor) { ?>]]></search>
            <add position="before" offset="1"><![CDATA[
            //added template
            $('#editor_disable').click(function(){
                <?php if ($ckeditor) { ?>
                    <?php foreach ($languages as $language) { ?>
                        if (CKEDITOR.instances[$('#input-description<?php echo $language['language_id']; ?>').attr('id')]) {
                            CKEDITOR.instances[$('#input-description<?php echo $language['language_id']; ?>').attr('id')].destroy(true);
                        }
                    <?php } ?>
                    $('#content textarea').css('visibility','visible');
                <?php } else { ?>
                    $('.note-editor').remove();
                    $('#content textarea').show();
                <?php } ?>
            });
            $('#editor_enable').click(function(){
            //added template
			]]></add>
        </operation>
        <operation>
            <search trim="true" index="0"><![CDATA[//--></script>]]></search>
            <add position="before"><![CDATA[
            //added template
            });
            <?php if ($editor) { ?>
                <?php foreach ($languages as $language) { ?>
                    <?php if ($ckeditor) { ?>
                        ckeditorInit('input-description<?php echo $language['language_id']; ?>', '<?php echo $token; ?>');
                    <?php } else { ?>
                        $('#input-description<?php echo $language['language_id']; ?>').summernote({height: 300, lang:'<?php echo $lang; ?>'});
                    <?php } ?>
                <?php } ?>
            <?php } ?>
            //added template
			]]></add>
        </operation>
    </file>

    <file path="catalog/controller/common/cart.php">
        <operation>
            <search ><![CDATA[$this->load->model('tool/image');]]></search>
            <add position="before"><![CDATA[
                //added template
                $this->load->language('common/template');
                $data['text_continue'] = $this->language->get('text_continue');
                $data['text_popup_cart'] = $this->language->get('text_popup_cart');
                //added template
			]]></add>
        </operation>
        <operation>
            <search ><![CDATA[$image = $this->model_tool_image->resize($product['image'], $this->config->get('config_image_cart_width'), $this->config->get('config_image_cart_height'));]]></search>
            <add position="replace"><![CDATA[
            $image = $this->model_tool_image->resize($product['image'], $this->config->get('config_image_cart_popup_width'), $this->config->get('config_image_cart_popup_height'));
			]]></add>
        </operation>
        <operation>
            <search ><![CDATA[$image = '';]]></search>
            <add position="replace"><![CDATA[
            $image = $this->model_tool_image->resize('placeholder.png', $this->config->get('config_image_cart_popup_width'), $this->config->get('config_image_cart_popup_height'));
			]]></add>
        </operation>
        <operation>
            <search ><![CDATA['quantity'  => $product['quantity'],]]></search>
            <add position="before"><![CDATA[
            'reward'    => ($product['reward'] ? sprintf($this->language->get('text_points'), $product['reward']) : ''), //added template
			]]></add>
        </operation>
    </file>

    <file path="catalog/controller/common/header.php">
        <operation>
            <search ><![CDATA[class ControllerCommonHeader extends Controller {]]></search>
            <add position="after"><![CDATA[
            //added template
            private function getHtml($module) {
                $this->load->model('extension/module');
                $html_data = '';

                if (isset($module) && $module != '0') {
                    $html_data = array();
                    $part = explode('.', $module);

                    if (isset($part[0]) && $this->config->get($part[0] . '_status')) {
                        $html_data[] = $this->load->controller('module/' . $part[0]);
                    }

                    if (isset($part[1])) {
                        $setting_info = $this->model_extension_module->getModule($part[1]);
                        if ($setting_info && $setting_info['status']) {
                            $html_data[] = $this->load->controller('module/' . $part[0], $setting_info);
                        }
                    }

                    if (isset($html_data[0])) {
                        $html_data = $html_data[0];
                    } else {
                        $html_data ='';
                    }

                }

                return $html_data;
            }
            //added template
			]]></add>
        </operation>
        <operation>
            <search ><![CDATA[$this->load->language('common/header');]]></search>
            <add position="after"><![CDATA[
            //added template
            $data['search_link'] = $this->url->link('product/search');
            $this->load->language('common/template');

            $this->load->model('catalog/information_category');
            $information_categories = $this->model_catalog_information_category->getInformationCategorys();

            $data['information_categories'] = array();
            foreach ($information_categories as $information_category) {
                if ($information_category['status'] == 1) {
                    $data['information_categories'][] = array(
                        'information_category_id' => $information_category['information_category_id'],
                        'name' => $information_category['name'],
                        'href' => $this->url->link('information/information_category', 'information_category_id=' .  $information_category['information_category_id'])
                    );
                }
            }
            $data['text_info'] = $this->language->get('text_info');
            $data['topleft_html_module'] = $this->getHtml($this->config->get('config_topleft_html_module'));
            $data['top_html_module'] = $this->getHtml($this->config->get('config_top_html_module'));
            $data['top_info'] = $this->config->get('config_top_info');

            $data['telephone_add'] = nl2br($this->config->get('config_telephone_add'));
            $data['header_phone'] = $this->config->get('config_header_phone');
            $data['header_phone_add'] = $this->config->get('config_header_phone_add');
            $data['header_widget'] = $this->config->get('config_header_widget');
            $data['header_html_module'] = $this->getHtml($this->config->get('config_header_html_module'));
            if($this->config->get('config_widget_code')){
                $operators = explode(PHP_EOL, $this->config->get('config_widget_code'));
                $data['widget_phones'] = array();
                 foreach($operators as $operator){
                    $operator_array = explode("==", $operator);
                     $data['widget_phones'][] = array(
                         'operator' => $operator_array[0],
                         'code' => $operator_array[1],
                         'phone' => $operator_array[2]
                     );
                };
            }

            $data['premenu_html_module'] = $this->getHtml($this->config->get('config_premenu_html_module'));
            $data['aftermenu_html_module'] = $this->getHtml($this->config->get('config_aftermenu_html_module'));

            $data['color_theme_id'] = $this->config->get('config_color_theme_id');
            $data['maincolor'] = $this->config->get('config_maincolor');
            $data['mainhovercolor'] = $this->config->get('config_mainhovercolor');
            $data['custom_css'] = $this->config->get('config_custom_css');
            //added template
			]]></add>
        </operation>
        <operation>
            <search ><![CDATA[$data['cart'] = $this->load->controller('common/cart');]]></search>
            <add position="after"><![CDATA[
            //added
            if (isset($this->request->get['route'])) {
                $route = str_replace('/', '-', $this->request->get['route']);
            } else {
                $route = 'common-home';
            }
            $data['scripts_to_footer'] = false;
            $data['merge_css'] = $this->config->get('config_merge_css');
            $data['inline_css'] = $this->config->get('config_inline_css');

            $path_str = substr($route, 0, 8);
            if ((($path_str == 'common-h') || ($path_str == 'product-') || ($path_str == 'informat')) && ($this->config->get('config_move_scripts') == 1)) {
                $data['scripts_to_footer'] = true;
            };
            if ($this->config->get('config_merge_css')) {
                $css = array(
                    HTTP_SERVER . 'catalog/view/theme/default/javascript/bootstrap/css/bootstrap.min.css',
                    HTTP_SERVER . 'catalog/view/theme/default/stylesheet/stylesheet.css',
                    HTTP_SERVER . 'catalog/view/theme/default/stylesheet/responsive.css'
                );

                $modules = array();
                foreach ($data['styles'] as $key => $value) {
                    $modules[$key] = $value['href'];
                }
                $css = array_merge($css, $modules);

                function compress($buffer)
                {
                    $buffer = preg_replace('!/\*[^*]*\*+([^/][^*]*\*+)*/!', '', $buffer);
                    $buffer = str_replace(array("\r\n", "\r", "\n", "\t", '  ', '    ', '    '), '', $buffer);
                    return $buffer;
                }

                $css_content = '';

                $cache_filename = DIR_CACHE . 'style_' . $route . '.css';
                $cache_style = glob($cache_filename);

                if ($cache_style) {
                    if ($this->config->get('config_inline_css')) {
                        $data['css_content'] = file_get_contents($cache_filename);
                    }
                } else {
                    foreach ($css as $css_file) {
                        $css_content .= compress(file_get_contents($css_file));
                    }
                    if ($this->config->get('config_inline_css')) {
                        $data['css_content'] = $css_content;
                    }
                    $file = $cache_filename;
                    $handle = fopen($file, 'w');
                    flock($handle, LOCK_EX);
                    fwrite($handle, $css_content);
                    fflush($handle);
                    flock($handle, LOCK_UN);
                    fclose($handle);
                }
                $data['cache_style'] = HTTP_SERVER . 'system/storage/cache/style_' . $route . '.css';
            }
            //added
            ]]></add>
        </operation>
    </file>

    <file path="catalog/controller/common/home.php">
        <operation>
            <search ><![CDATA[$data['column_left'] = $this->load->controller('common/column_left');]]></search>
            <add position="before"><![CDATA[
            $data['promo_top'] = $this->load->controller('common/promo_top'); //added template
			]]></add>
        </operation>
    </file>

    <file path="catalog/controller/common/footer.php">
        <operation>
            <search ><![CDATA[class ControllerCommonFooter extends Controller {]]></search>
            <add position="after"><![CDATA[
            //added template
            private function getHtml($module) {
                $this->load->model('extension/module');
                $html_data = '';

                if (isset($module) && $module != '0') {
                    $html_data = array();
                    $part = explode('.', $module);

                    if (isset($part[0]) && $this->config->get($part[0] . '_status')) {
                        $html_data[] = $this->load->controller('module/' . $part[0]);
                    }

                    if (isset($part[1])) {
                        $setting_info = $this->model_extension_module->getModule($part[1]);
                        if ($setting_info && $setting_info['status']) {
                            $html_data[] = $this->load->controller('module/' . $part[0], $setting_info);
                        }
                    }

                    if (isset($html_data[0])) {
                        $html_data = $html_data[0];
                    } else {
                        $html_data ='';
                    }

                }

                return $html_data;
            }
            //added template
    			]]></add>
        </operation>
        <operation>
            <search ><![CDATA[$this->load->language('common/footer');]]></search>
            <add position="after"><![CDATA[
            //added template
            $this->load->model('catalog/information_category');
            $information_categories = $this->model_catalog_information_category->getInformationCategorys();

            $data['information_categories'] = array();
            foreach ($information_categories as $information_category) {
                if ($information_category['status'] == 1) {
                    $data['information_categories'][] = array(
                        'information_category_id' => $information_category['information_category_id'],
                        'name' => $information_category['name'],
                        'href' => $this->url->link('information/information_category', 'information_category_id=' .  $information_category['information_category_id'])
                    );
                }
            }
            $data['address'] = nl2br($this->config->get('config_address'));
            $data['telephone'] = $this->config->get('config_telephone');
            $data['show_scrollup'] = $this->config->get('config_show_scrollup');
            $data['telephone_add'] = nl2br($this->config->get('config_telephone_add'));

            $data['footerone_html_module'] = $this->getHtml($this->config->get('config_footerone_html_module'));
            $data['footertwo_html_module'] = $this->getHtml($this->config->get('config_footertwo_html_module'));
            $data['footerthree_html_module'] = $this->getHtml($this->config->get('config_footerthree_html_module'));
            $data['footerfour_html_module'] = $this->getHtml($this->config->get('config_footerfour_html_module'));
            $data['povered_html_module'] = $this->getHtml($this->config->get('config_povered_html_module'));

            $data['footer_banners'] = array();
            if ($this->config->get('config_footer_banner_id')) {
                $this->load->model('design/banner');
                $this->load->model('tool/image');
                $results = $this->model_design_banner->getBanner($this->config->get('config_footer_banner_id'));
                foreach ($results as $result) {
                    if (is_file(DIR_IMAGE . $result['image'])) {
                        $data['footer_banners'][] = array(
                            'title' => $result['title'],
                            'link'  => $result['link'],
                            'image' => $this->model_tool_image->resize($result['image'], 44, 44)
                        );
                    }
                }
            }

            //added template
    			]]></add>
        </operation>
        <operation>
            <search ><![CDATA[$data['scripts'] = $this->document->getScripts('footer');]]></search>
            <add position="after"><![CDATA[
            //added
            $data['scripts_to_footer'] = false;
            if (isset($this->request->get['route'])) {
                $route = str_replace('/', '-', $this->request->get['route']);
            } else {
                $route = 'common-home';
            }

            $path_str = substr($route, 0, 8);
            if ((($path_str == 'common-h' ) || ($path_str == 'product-' ) || ($path_str == 'informat' )) && ($this->config->get('config_move_scripts') == 1)) {
                $data['scripts'] = array_merge($data['scripts'], $this->document->getScripts());
                $data['scripts_to_footer'] = true;
            }
            //added
            ]]></add>
        </operation>
    </file>

	<file path="catalog/controller/common/{content_top,promo_top,content_bottom,column_right,column_left}.php">
		<operation>
			<search ><![CDATA[
				$setting_info = $this->model_extension_module->getModule($part[1]);
			]]></search>
			<add position="after"><![CDATA[
				$setting_info['position'] = basename(__FILE__, '.php');
			]]></add>
		</operation>
	</file>

    <file path="catalog/controller/checkout/cart.php">
        <operation>
            <search ><![CDATA[public function remove() {]]></search>
            <add position="before"><![CDATA[
            //added template
            public function live_edit() {
                $this->load->language('checkout/cart');

                $json = array();

                // Update
                if (isset($this->request->post['key'])) {
                    $this->cart->update($this->request->post['key'], $this->request->post['quantity']);

                    unset($this->session->data['vouchers'][$this->request->post['key']]);

                    $this->session->data['success'] = $this->language->get('text_remove');

                    unset($this->session->data['shipping_method']);
                    unset($this->session->data['shipping_methods']);
                    unset($this->session->data['payment_method']);
                    unset($this->session->data['payment_methods']);
                    unset($this->session->data['reward']);

                    // Totals
                    $this->load->model('extension/extension');

                    $total_data = array();
                    $total = 0;
                    $taxes = $this->cart->getTaxes();

                    // Display prices
                    if (($this->config->get('config_customer_price') && $this->customer->isLogged()) || !$this->config->get('config_customer_price')) {
                        $sort_order = array();

                        $results = $this->model_extension_extension->getExtensions('total');

                        foreach ($results as $key => $value) {
                            $sort_order[$key] = $this->config->get($value['code'] . '_sort_order');
                        }

                        array_multisort($sort_order, SORT_ASC, $results);

                        foreach ($results as $result) {
                            if ($this->config->get($result['code'] . '_status')) {
                                $this->load->model('total/' . $result['code']);

                                $this->{'model_total_' . $result['code']}->getTotal($total_data, $total, $taxes);
                            }
                        }

                        $sort_order = array();

                        foreach ($total_data as $key => $value) {
                            $sort_order[$key] = $value['sort_order'];
                        }

                        array_multisort($sort_order, SORT_ASC, $total_data);
                    }

                    $json['total'] = sprintf($this->language->get('text_items'), $this->cart->countProducts() + (isset($this->session->data['vouchers']) ? count($this->session->data['vouchers']) : 0), $this->currency->format($total));

                }

                $this->response->addHeader('Content-Type: application/json');
                $this->response->setOutput(json_encode($json));
            }

            public function clickToOrder() {
                $this->load->language('checkout/cart');
                $this->load->language('common/template');

                $json = array();

                if (isset($this->request->post['product_id'])) {
                    $product_id = (int)$this->request->post['product_id'];
                } else {
                    $product_id = 0;
                }

                $this->load->model('catalog/product');

                $product_info = $this->model_catalog_product->getProduct($product_id);

                if ($product_info) {
                    if (isset($this->request->post['quantity']) && ((int)$this->request->post['quantity'] >= $product_info['minimum'])) {
                        $quantity = (int)$this->request->post['quantity'];
                    } else {
                        $quantity = $product_info['minimum'] ? $product_info['minimum'] : 1;
                    }

                    if (isset($this->request->post['option'])) {
                        $option = array_filter($this->request->post['option']);
                    } else {
                        $option = array();
                    }

                    if (isset($this->request->post['cto_telephone'])) {
                        $cto_telephone = $this->request->post['cto_telephone'];
                        $cto_telephone_symbols = preg_replace('/\s|\+|-|\(|\)/','', $cto_telephone);
                    } else {
                        $cto_telephone = '';
                    }

                    if ((!$cto_telephone) || (!is_numeric($cto_telephone_symbols)) || (strlen($cto_telephone_symbols) < 5) ) {
                        $json['error']['cto_telephone'] = $this->language->get('error_cto_telephone');
                    }

                    $product_options = $this->model_catalog_product->getProductOptions($this->request->post['product_id']);

                    foreach ($product_options as $product_option) {
                        if ($product_option['required'] && empty($option[$product_option['product_option_id']])) {
                            $json['error']['option'][$product_option['product_option_id']] = sprintf($this->language->get('error_required'), $product_option['name']);
                        }
                    }

                    if (isset($this->request->post['recurring_id'])) {
                        $recurring_id = $this->request->post['recurring_id'];
                    } else {
                        $recurring_id = 0;
                    }

                    $recurrings = $this->model_catalog_product->getProfiles($product_info['product_id']);

                    if ($recurrings) {
                        $recurring_ids = array();

                        foreach ($recurrings as $recurring) {
                            $recurring_ids[] = $recurring['recurring_id'];
                        }

                        if (!in_array($recurring_id, $recurring_ids)) {
                            $json['error']['recurring'] = $this->language->get('error_recurring_required');
                        }
                    }

                    if (!$json) {
                        $json['success_link'] = $this->url->link('checkout/success', '', 'SSL');

                        $this->cart->clear();
                        $this->cart->add($this->request->post['product_id'], $quantity, $option, $recurring_id);

                        // Unset all shipping and payment methods
                        unset($this->session->data['shipping_method']);
                        unset($this->session->data['shipping_methods']);
                        unset($this->session->data['payment_method']);
                        unset($this->session->data['payment_methods']);

                        $order_data = array();
                        $order_data['totals'] = array();
                        $order_status_id = 1;
                        $total = 0;
                        $taxes = $this->cart->getTaxes();

                        // Totals
                        $this->load->model('extension/extension');
                        $sort_order = array();
                        $results = $this->model_extension_extension->getExtensions('total');

                        foreach ($results as $key => $value) {
                            $sort_order[$key] = $this->config->get($value['code'] . '_sort_order');
                        }

                        array_multisort($sort_order, SORT_ASC, $results);

                        foreach ($results as $result) {
                            if ($this->config->get($result['code'] . '_status')) {
                                $this->load->model('total/' . $result['code']);
                                $this->{'model_total_' . $result['code']}->getTotal($order_data['totals'], $total, $taxes);
                            }
                        }

                        $sort_order = array();

                        foreach ($order_data['totals'] as $key => $value) {
                            $sort_order[$key] = $value['sort_order'];
                        }

                        array_multisort($sort_order, SORT_ASC, $order_data['totals']);

                        //products
                        $order_data['products'] = array();

                        foreach ($this->cart->getProducts() as $product) {
                            $option_data = array();

                            foreach ($product['option'] as $option) {
                                $option_data[] = array(
                                    'product_option_id'       => $option['product_option_id'],
                                    'product_option_value_id' => $option['product_option_value_id'],
                                    'option_id'               => $option['option_id'],
                                    'option_value_id'         => $option['option_value_id'],
                                    'name'                    => $option['name'],
                                    'value'                   => $option['value'],
                                    'type'                    => $option['type']
                                );
                            }

                            $order_data['products'][] = array(
                                'product_id' => $product['product_id'],
                                'name'       => $product['name'],
                                'model'      => $product['model'],
                                'option'     => $option_data,
                                'download'   => $product['download'],
                                'quantity'   => $product['quantity'],
                                'subtract'   => $product['subtract'],
                                'price'      => $product['price'],
                                'total'      => $product['total'],
                                'tax'        => $this->tax->getTax($product['price'], $product['tax_class_id']),
                                'reward'     => $product['reward']
                            );
                        }
                        $order_data['total'] = $total;
                        $order_data['invoice_prefix'] = $this->config->get('config_invoice_prefix');
                        $order_data['store_id'] = $this->config->get('config_store_id');
                        if ($order_data['store_id']) {
                            $order_data['store_url'] = $this->config->get('config_url');
                        } else {
                            $order_data['store_url'] = HTTP_SERVER;
                        }
                        $order_data['store_name'] = $this->config->get('config_name');

                        $order_data['customer_id'] = 0;
                        $order_data['firstname'] = 'Заказ в один клик ' . $cto_telephone;
                        $order_data['email'] = 'empty@localhost';
                        $order_data['telephone'] = $cto_telephone;

                        $order_data['customer_group_id'] = '';
                        $order_data['lastname'] = '';
                        $order_data['fax'] = '';
                        $order_data['custom_field'] = '';

                        // empty fields
                        if ($this->customer->isLogged()) {
                            $this->load->model('account/customer');
                            $this->session->data['account'] = 'guest';
                            $customer_info = $this->model_account_customer->getCustomer($this->customer->getId());
                            $order_data['customer_id'] = $this->customer->getId();
                            $order_data['customer_group_id'] = $customer_info['customer_group_id'];
                            $order_data['firstname'] = $customer_info['firstname'];
                            $order_data['lastname'] = $customer_info['lastname'];
                            $order_data['email'] = $customer_info['email'];
                            $order_data['telephone'] = $cto_telephone;
                            $order_data['fax'] = '';
                            unset($this->session->data['guest']);
                        } else {
                            $this->session->data['account'] = 'guest';
                            $order_data['customer_id'] = 0;
                            $order_data['customer_group_id'] = $this->config->get('config_customer_group_id');
                            $order_data['firstname'] = 'Заказ в один клик';
                            $order_data['lastname'] = $cto_telephone;
                            $order_data['email'] = 'empty@localhost';
                            $order_data['telephone'] = $cto_telephone;
                            $order_data['fax'] = '';
                        }

                        $order_data['payment_firstname'] = '';
                        $order_data['payment_lastname'] = '';
                        $order_data['payment_company'] = '';
                        $order_data['payment_address_1'] = '';
                        $order_data['payment_address_2'] = '';
                        $order_data['payment_city'] = '';
                        $order_data['payment_postcode'] = '';
                        $order_data['payment_zone'] = '';
                        $order_data['payment_zone_id'] = '';
                        $order_data['payment_country'] = '';
                        $order_data['payment_country_id'] = '';
                        $order_data['payment_address_format'] = '';
                        $order_data['payment_method'] = 'none';
                        $order_data['payment_code'] = 'none';

                        $order_data['shipping_firstname'] = '';
                        $order_data['shipping_lastname'] = '';
                        $order_data['shipping_company'] = '';
                        $order_data['shipping_address_1'] = '';
                        $order_data['shipping_address_2'] = '';
                        $order_data['shipping_city'] = '';
                        $order_data['shipping_postcode'] = '';
                        $order_data['shipping_zone'] = '';
                        $order_data['shipping_zone_id'] = '';
                        $order_data['shipping_country'] = '';
                        $order_data['shipping_country_id'] = '';
                        $order_data['shipping_address_format'] = '';
                        $order_data['shipping_method'] = 'none';
                        $order_data['shipping_code'] = 'none';

                        $order_data['language_id'] = $this->config->get('config_language_id');
                        $order_data['currency_id'] = $this->currency->getId();
                        $order_data['currency_code'] = $this->currency->getCode();
                        $order_data['currency_value'] = $this->currency->getValue($this->currency->getCode());
                        $order_data['ip'] = $this->request->server['REMOTE_ADDR'];
                        $order_data['comment'] = '';

                        //Для Activity
                        $this->session->data['guest']['firstname'] = $order_data['firstname'];
                        $this->session->data['guest']['lastname'] = $order_data['lastname'];

                        if (isset($this->request->cookie['tracking'])) {
                            $order_data['tracking'] = $this->request->cookie['tracking'];

                            $subtotal = $this->cart->getSubTotal();

                            // Affiliate
                            $this->load->model('affiliate/affiliate');

                            $affiliate_info = $this->model_affiliate_affiliate->getAffiliateByCode($this->request->cookie['tracking']);

                            if ($affiliate_info) {
                                $order_data['affiliate_id'] = $affiliate_info['affiliate_id'];
                                $order_data['commission'] = ($subtotal / 100) * $affiliate_info['commission'];
                            } else {
                                $order_data['affiliate_id'] = 0;
                                $order_data['commission'] = 0;
                            }

                            // Marketing
                            $this->load->model('checkout/marketing');

                            $marketing_info = $this->model_checkout_marketing->getMarketingByCode($this->request->cookie['tracking']);

                            if ($marketing_info) {
                                $order_data['marketing_id'] = $marketing_info['marketing_id'];
                            } else {
                                $order_data['marketing_id'] = 0;
                            }
                        } else {
                            $order_data['affiliate_id'] = 0;
                            $order_data['commission'] = 0;
                            $order_data['marketing_id'] = 0;
                            $order_data['tracking'] = '';
                        }

                        if (!empty($this->request->server['HTTP_X_FORWARDED_FOR'])) {
                            $order_data['forwarded_ip'] = $this->request->server['HTTP_X_FORWARDED_FOR'];
                        } elseif (!empty($this->request->server['HTTP_CLIENT_IP'])) {
                            $order_data['forwarded_ip'] = $this->request->server['HTTP_CLIENT_IP'];
                        } else {
                            $order_data['forwarded_ip'] = '';
                        }

                        if (isset($this->request->server['HTTP_USER_AGENT'])) {
                            $order_data['user_agent'] = $this->request->server['HTTP_USER_AGENT'];
                        } else {
                            $order_data['user_agent'] = '';
                        }

                        if (isset($this->request->server['HTTP_ACCEPT_LANGUAGE'])) {
                            $order_data['accept_language'] = $this->request->server['HTTP_ACCEPT_LANGUAGE'];
                        } else {
                            $order_data['accept_language'] = '';
                        }

                        $this->load->model('checkout/order');
                        $this->session->data['order_id'] = $this->model_checkout_order->addOrder($order_data);
                        $this->model_checkout_order->addOrderHistory($this->session->data['order_id'], $order_status_id, '', false);

                    }
                }

                $this->response->addHeader('Content-Type: application/json');
                $this->response->setOutput(json_encode($json));
            }
            //added template
            ]]></add>
        </operation>
    </file>

    <file path="catalog/controller/information/contact.php">
        <operation>
            <search ><![CDATA[$data['telephone'] = $this->config->get('config_telephone');]]></search>
            <add position="after"><![CDATA[
            //added template
		    $data['telephone_add'] = nl2br($this->config->get('config_telephone_add'));
			]]></add>
        </operation>
    </file>

	<file path="catalog/controller/module/{bestseller,featured,latest,special}.php">
        <operation>
            <search ><![CDATA[
				$data['products'] = array();
			]]></search>
            <add position="before"><![CDATA[
				$data['position'] = $setting['position'];
			]]></add>
        </operation>
	</file>

	<file path="catalog/controller/module/{bestseller,featured,latest,special}.php|catalog/controller/product/{category,manufacturer,product,search,special}.php">
		<operation>
			<search ><![CDATA[
				$data['products'] = array();
			]]></search>
			<add position="after"><![CDATA[
			    //added template
			    $this->load->language('common/template');
			    $data['label_1'] = $this->language->get('label_1');
			    $data['label_2'] = $this->language->get('label_2');
			    $data['label_3'] = $this->language->get('label_3');
			    $data['label_4'] = $this->language->get('label_4');
			    $data['label_5'] = $this->language->get('label_5');
			    $data['label_special'] = $this->language->get('label_special');
				//added template
			]]></add>
		</operation>
	</file>

	<file path="catalog/controller/module/{bestseller,special,latest}.php|catalog/controller/product/{category,manufacturer,product,search,special}.php">
        <operation>
            <search ><![CDATA[
				if ((float)$result['special']) {
			]]></search>
            <add position="after"><![CDATA[
                $percent = round(($result['price'] - $result['special']) / $result['price'] * 100);
			]]></add>
        </operation>
        <operation>
            <search ><![CDATA[
				$special = false;
			]]></search>
            <add position="after"><![CDATA[
                $percent = false;
			]]></add>
        </operation>
		<operation>
			<search ><![CDATA[
				$data['products'][] = array(
			]]></search>
			<add position="after"><![CDATA[
			    'percent'         => $percent,
			    'short_description'  => nl2br($result['short_description']),
                'promo_label_id'  => $result['promo_label_id'],
                'quantity'        => $result['quantity'],
                'stock_status'    => $result['stock_status'],
			]]></add>
		</operation>
	</file>

	<file path="catalog/controller/module/featured.php">
		<operation>
			<search ><![CDATA[
				if ((float)$product_info['special']) {
			]]></search>
			<add position="after"><![CDATA[
                $percent = round(($product_info['price'] - $product_info['special']) / $product_info['price'] * 100);
			]]></add>
		</operation>
        <operation>
			<search ><![CDATA[
				$special = false;
			]]></search>
			<add position="after"><![CDATA[
                $percent = false;
			]]></add>
		</operation>
        <operation>
			<search ><![CDATA[
				$data['products'][] = array(
			]]></search>
			<add position="after"><![CDATA[
                'percent'         => $percent,
                'short_description'  => nl2br($product_info['short_description']),
                'promo_label_id'  => $product_info['promo_label_id'],
                'quantity'        => $product_info['quantity'],
                'stock_status'    => $product_info['stock_status'],
			]]></add>
		</operation>
	</file>

    <file path="catalog/controller/product/category.php">
        <operation>
            <search ><![CDATA[$data['text_refine'] = $this->language->get('text_refine');]]></search>
            <add position="before"><![CDATA[
            //added template
            $data['show_text_refine'] = $this->config->get('config_show_text_refine');
            $data['subcat_text_view'] = $this->config->get('config_subcat_text_view');
            $data['category_description_top'] = $this->config->get('config_category_description_top');
            $data['category_show_image'] = $this->config->get('config_category_show_image');
            //added template
			]]></add>
        </operation>
        <operation>
            <search ><![CDATA[$data['categories'][] = array(]]></search>
            <add position="before"><![CDATA[
            //added template
            if ($result['image']) {
                $image = $this->model_tool_image->resize($result['image'], $this->config->get('config_image_subcat_width'), $this->config->get('config_image_subcat_height'));
            } else {
                $image = $this->model_tool_image->resize('placeholder.png', $this->config->get('config_image_subcat_width'), $this->config->get('config_image_subcat_height'));
            }
            //added template
			]]></add>
        </operation>
        <operation>
            <search ><![CDATA[$data['categories'][] = array(]]></search>
            <add position="after"><![CDATA[
            'thumb'       => $image, //added template
			]]></add>
        </operation>
    </file>

    <file path="catalog/controller/product/product.php">
        <operation>
            <search ><![CDATA[$this->document->addScript('catalog/view/javascript/jquery/datetimepicker/moment.js');]]></search>
            <add position="before"><![CDATA[
            //added template
            if (!$this->config->get('config_disable_fastorder')) {
                $data['fastorder'] = true;
            } else {
                $data['fastorder'] = false;
            };
            if (!$this->config->get('config_disable_timepicker')) {
            $data['timepicker_status'] = true;
            //added template
            ]]></add>
        </operation>
        <operation>
            <search ><![CDATA[$this->document->addStyle('catalog/view/javascript/jquery/datetimepicker/bootstrap-datetimepicker.min.css');]]></search>
            <add position="after"><![CDATA[
            //added template
            } else {
                $data['timepicker_status'] = false;
            }
            //added template
            ]]></add>
        </operation>
        <operation>
            <search ><![CDATA[$this->load->model('tool/image');]]></search>
            <add position="after"><![CDATA[
            //added template
            $this->document->addScript('catalog/view/theme/default/javascript/perfect-scrollbar/js/min/perfect-scrollbar.jquery.min.js');
            $this->document->addStyle('catalog/view/theme/default/javascript/perfect-scrollbar/css/perfect-scrollbar.min.css');
            $data['thumb_height'] = $this->config->get('config_image_thumb_height');
			if ($product_info['image']) {
				$data['small_thumb'] = $this->model_tool_image->resize($product_info['image'], $this->config->get('config_image_additional_width'), $this->config->get('config_image_additional_height'));
			} else {
				$data['small_thumb'] = '';
			}
            //added template
            ]]></add>
        </operation>
        <operation>
            <search ><![CDATA[$data['images'][] = array(]]></search>
            <add position="after"><![CDATA[
            //added template
			'src' => $this->model_tool_image->resize($result['image'], $this->config->get('config_image_thumb_width'), $this->config->get('config_image_thumb_height')),
            ]]></add>
        </operation>
    </file>

    <file path="catalog/model/catalog/product.php">
        <operation>
            <search ><![CDATA['meta_keyword'     => $query->row['meta_keyword'],]]></search>
            <add position="after"><![CDATA[
            'short_description'     => $query->row['short_description'], //added template
			]]></add>
        </operation>
        <operation>
            <search ><![CDATA['mpn'              => $query->row['mpn'],]]></search>
            <add position="before"><![CDATA[
            'promo_label_id'   => $query->row['promo_label_id'], //added template
			]]></add>
        </operation>
        <operation>
            <search index="0"><![CDATA[if (isset($data['sort']) && in_array($data['sort'], $sort_data)) {]]></search>
            <add position="before"><![CDATA[
            //added template
            if ($this->config->get('config_not_instock_toend')) {
                if (isset($data['sort']) && in_array($data['sort'], $sort_data)) {
                    if ($data['sort'] == 'pd.name' || $data['sort'] == 'p.model') {
                        $sql .= " ORDER BY IF(p.quantity <= 0, 1, 0), LCASE(" . $data['sort'] . ")";
                    } elseif ($data['sort'] == 'p.price') {
                        $sql .= " ORDER BY IF(p.quantity <= 0, 1, 0), (CASE WHEN special IS NOT NULL THEN special WHEN discount IS NOT NULL THEN discount ELSE p.price END)";
                    } else {
                        $sql .= " ORDER BY IF(p.quantity <= 0, 1, 0), " . $data['sort'];
                    }
                } else {
                    $sql .= " ORDER BY IF(p.quantity <= 0, 1, 0), p.sort_order";
                }
            } else {
            //added template
            ]]></add>
        </operation>
        <operation>
            <search index="0"><![CDATA[if (isset($data['order']) && ($data['order'] == 'DESC')) {]]></search>
            <add position="before"><![CDATA[
                } //added template
            ]]></add>
        </operation>
    </file>

</modification>